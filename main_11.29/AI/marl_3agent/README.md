# 🤖 Libri - QMIX 기반 주식 트레이딩 AI

> QMIX (Multi-Agent Reinforcement Learning) 알고리즘을 활용한 삼성전자 주식 자동매매 시스템

## 📌 프로젝트 개요

**Libri**는 강화학습 기반 다중 에이전트 시스템(MARL)을 통해 주식 시장을 분석하고 매매 신호를 생성하는 AI 트레이딩 시스템입니다. 3개의 전문화된 에이전트가 협력하여 기술적 지표, 시장 정보, 펀더멘탈 데이터를 종합적으로 분석합니다.

### 주요 특징
- ✅ **QMIX 알고리즘**: 다중 에이전트 강화학습으로 복잡한 시장 분석
- ✅ **3개 전문 에이전트**: 기술적 분석, 시장 분석, 펀더멘탈 분석 전담
- ✅ **백테스트 시스템**: KOSPI 대비 성능 비교 및 시각화
- ✅ **조기 종료 메커니즘**: 과적합 방지 및 효율적 학습
- ✅ **사용자 포트폴리오 입력**: 현재 보유 주식 반영 가능

---

## 🏗️ 시스템 아키텍처

```
┌─────────────────────────────────────────────────────┐
│                   QMIX Learner                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────┐  │
│  │  Agent 0     │  │  Agent 1     │  │ Agent 2  │  │
│  │ (기술적 분석) │  │ (시장 분석)  │  │(펀더멘탈)│  │
│  └──────────────┘  └──────────────┘  └──────────┘  │
│         │                  │                │       │
│         └──────────────────┼────────────────┘       │
│                            ▼                        │
│                    Mixing Network                   │
│                    (Q_total 계산)                   │
└─────────────────────────────────────────────────────┘
                            │
                            ▼
                    최종 매매 신호 생성
```

---

## 📂 프로젝트 구조

```
2025-2-CSC4004-1-7-Libri/
├── main.py                 # 메인 실행 파일 (학습 + 백테스트)
├── config.py               # 하이퍼파라미터 설정
├── environment.py          # MARL 환경 (MARLStockEnv)
├── qmix_model.py          # QMIX 모델 및 에이전트 정의
├── replay_buffer.py       # Experience Replay Buffer
├── data_processor.py      # 데이터 수집 및 전처리
├── requirements.txt       # 의존성 패키지
├── best_model.pth         # 학습된 최고 성능 모델
└── backtest_result.png    # 백테스트 결과 그래프
```

---

## 🚀 빠른 시작

### 1. 환경 설정

```bash
# 저장소 클론
git clone https://github.com/CSID-DGU/2025-2-CSC4004-1-7-Libri.git
cd 2025-2-CSC4004-1-7-Libri

# 의존성 설치
pip install -r requirements.txt
```

### 2. 학습 실행

```bash
# 기본 학습 (포트폴리오 없음)
python main.py

# 현재 보유 주식 반영 (예: 10주, 평단가 60000원)
python main.py --quantity 10 --price 60000
```

### 3. 출력 결과

학습 완료 후 다음 정보가 출력됩니다:
- 📊 학습 통계 (에피소드별 보상, Q-value, Loss)
- 📈 백테스트 성능 (샤프 비율, MDD, 승률)
- 🎯 최종일 AI 매매 신호 및 근거
- 📉 백테스트 그래프 (KOSPI 대비 성능)

---

## ⚙️ 주요 하이퍼파라미터

| 파라미터 | 기본값 | 설명 |
|---------|--------|------|
| `NUM_EPISODES` | 300 | 학습 에피소드 수 |
| `WINDOW_SIZE` | 10 | 시계열 윈도우 크기 (10일) |
| `N_AGENTS` | 3 | 에이전트 수 |
| `BATCH_SIZE` | 64 | 미니배치 크기 |
| `EPSILON_START` | 1.0 | 초기 탐험률 |
| `EPSILON_END` | 0.1 | 최종 탐험률 |
| `WARMUP_STEPS` | 2000 | 랜덤 탐험 단계 |
| `LR` | 1e-4 | 학습률 |
| `GAMMA` | 0.99 | 할인율 |

설정 변경: `config.py` 파일 수정

---

## 📊 데이터 구조

### Agent 0: 기술적 분석
- **지표**: SMA20, MACD, MACD_Signal, RSI, Stoch_K, Stoch_D, ATR, Bollinger_B

### Agent 1: 시장 분석
- **지표**: VIX (변동성 지수), 거래량 변화율

### Agent 2: 펀더멘탈 분석
- **지표**: ROA (자산수익률), DebtRatio (부채비율), AnalystRating (애널리스트 평가)

---

## 📈 백테스트 예시

학습 후 생성되는 `backtest_result.png`에서 다음을 확인할 수 있습니다:

```
Strategy           Final Value        Return    vs KOSPI
---------------------------------------------------------
QMIX Agent         12,345,678 원      +23.46%    +8.12%
Buy & Hold         11,234,567 원      +12.35%    -3.01%
KOSPI              10,987,654 원      +9.88%     0.00%

Performance Metrics:
- Sharpe Ratio: 1.234
- Sortino Ratio: 1.567
- Max Drawdown: -12.34%
```

---

## 🎯 AI 매매 신호 해석

프로그램은 최종적으로 다음 신호 중 하나를 출력합니다:

| 신호 | 의미 | 조건 |
|-----|------|------|
| **적극 매수** | 강한 매수 신호 | 에이전트 점수 합 ≥ 3 |
| **매수** | 약한 매수 신호 | 에이전트 점수 합 > 0 |
| **보유** | 현상 유지 | 에이전트 점수 합 = 0 |
| **매도** | 약한 매도 신호 | 에이전트 점수 합 < 0 |
| **적극 매도** | 강한 매도 신호 | 에이전트 점수 합 ≤ -3 |

---

## 🔬 기술 스택

- **프레임워크**: PyTorch (딥러닝)
- **환경**: Gymnasium (강화학습 환경)
- **데이터**: yfinance (Yahoo Finance API)
- **분석**: pandas, numpy, scikit-learn
- **시각화**: matplotlib

---

## 📝 학습 과정

1. **Warmup Phase** (2000 steps): 랜덤 탐험으로 초기 경험 수집
2. **Epsilon Decay**: 탐험률을 1.0 → 0.1로 점진적 감소
3. **Experience Replay**: 과거 경험 재학습으로 안정성 향상
4. **Target Network**: 500 스텝마다 타겟 네트워크 업데이트
5. **Early Stopping**: 20 에피소드마다 검증, 100 에피소드 정체 시 중단

---

## ⚠️ 주의사항

> **투자 경고**: 이 프로그램은 교육 및 연구 목적으로 제작되었습니다. 실제 투자에 사용 시 발생하는 손실에 대해 개발자는 책임지지 않습니다.

- 과거 성과가 미래 수익을 보장하지 않습니다
- 백테스트 결과는 실제 거래와 다를 수 있습니다
- 거래 비용, 슬리피지 등이 단순화되어 있습니다

---

## 🤝 기여

이 프로젝트는 **동국대학교 CSC4004 강의**의 일환으로 개발되었습니다.

### 개선 제안
- Issue 탭에서 버그 리포트 및 기능 제안
- Pull Request를 통한 코드 기여

---

## 📄 라이선스

이 프로젝트는 교육 목적으로 공개되었습니다. 상업적 사용을 원할 경우 별도 문의 바랍니다.

---

**최종 업데이트**: 2025-11-20
