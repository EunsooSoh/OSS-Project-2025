# ğŸš€ ë°±ì—”ë“œ êµ¬í˜„ ê°€ì´ë“œ

## ğŸ“‹ í˜„ì¬ êµ¬í˜„ ìƒíƒœ

### âœ… ì™„ë£Œëœ ë¶€ë¶„
1. **MARL 4-agent ëª¨ë¸** - ì™„ì „íˆ ì—°ê²°ë¨
   - ê²½ë¡œ: `AI/marl_4agent/`
   - Predictor: `predictor.py` âœ…
   - ëª¨ë¸ íŒŒì¼: `qmix_model.pth` âœ…
   - Scaler: `scaler.pkl` âœ…

2. **MARL 3-agent ëª¨ë¸** - ì—°ê²° ì¤€ë¹„ ì™„ë£Œ
   - ê²½ë¡œ: `AI/marl_3agent/`
   - Predictor: `predictor.py` âœ… (ë°©ê¸ˆ ìƒì„±)
   - ëª¨ë¸ íŒŒì¼: `best_model.pth` âœ…
   - Scaler: `scaler.pkl` âš ï¸ (ìƒì„± í•„ìš”)

3. **FastAPI ë°±ì—”ë“œ**
   - `main.py`: ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„ ì™„ë£Œ âœ…
   - `model_loader.py`: 3ê°œ ëª¨ë¸ ë¡œë” êµ¬í˜„ âœ…
   - `gpt_service.py`: GPT API ì—°ë™ ì™„ë£Œ âœ…
   - `database.py`: PostgreSQL ì—°ê²° ì™„ë£Œ âœ…

### âš ï¸ êµ¬í˜„ í•„ìš”í•œ ë¶€ë¶„

1. **MARL 3-agent Scaler ìƒì„±** â­ í•„ìˆ˜
   - ì‹¤í–‰: `python AI/marl_3agent/create_scaler.py`
   - **ì¤‘ìš”**: MARL 4-agentì™€ feature êµ¬ì¡°ê°€ ë‹¤ë¥´ë¯€ë¡œ ë³„ë„ scaler í•„ìš”
     - MARL 4-agent: 23ê°œ features (ê°ì„± ì§€í‘œ í¬í•¨)
     - MARL 3-agent: 13ê°œ features (ê¸°ë³¸ ì§€í‘œë§Œ)

2. **A2C ëª¨ë¸ (Model 3)**
   - ê²½ë¡œ: `AI/a2c_file` (í˜„ì¬ ë¹„ì–´ìˆìŒ)
   - ì˜µì…˜ 1: A2C ì•Œê³ ë¦¬ì¦˜ ìƒˆë¡œ êµ¬í˜„
   - ì˜µì…˜ 2: ë‹¤ë¥¸ ëª¨ë¸ë¡œ ëŒ€ì²´ (DQN, PPO ë“±)
   - ì˜µì…˜ 3: ë‹¹ë¶„ê°„ ë”ë¯¸ ëª¨ë“œë¡œ ìš´ì˜

3. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**
   - `.env` íŒŒì¼ ìƒì„± ë° ì„¤ì •

4. **ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”**
   - PostgreSQL ì„¤ì¹˜ ë° DB ìƒì„±

---

## ğŸ”§ ì„¸ ê°œ ëª¨ë¸ ì—°ê²° êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FastAPI Backend                      â”‚
â”‚                      (main.py)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Model Loader                          â”‚
â”‚                 (model_loader.py)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Model 1    â”‚  â”‚   Model 2    â”‚  â”‚   Model 3    â”‚  â”‚
â”‚  â”‚ MARL 4-agent â”‚  â”‚ MARL 3-agent â”‚  â”‚     A2C      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                 â”‚                  â”‚          â”‚
â”‚         â–¼                 â–¼                  â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ predictor.py â”‚  â”‚ predictor.py â”‚  â”‚ predictor.py â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                 â”‚                  â”‚          â”‚
â”‚         â–¼                 â–¼                  â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚qmix_model.pthâ”‚  â”‚best_model.pthâ”‚  â”‚  model.pth   â”‚  â”‚
â”‚  â”‚ scaler.pkl   â”‚  â”‚ scaler.pkl   â”‚  â”‚ scaler.pkl   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ êµ¬í˜„ ë‹¨ê³„ë³„ ê°€ì´ë“œ

### Step 1: MARL 3-agent Scaler ìƒì„±

```bash
cd AI/marl_3agent
python create_scaler.py
```

ì´ ëª…ë ¹ì–´ëŠ” `scaler.pkl` íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

### Step 2: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`BE/.env` íŒŒì¼ ìƒì„±:

```bash
# Database
DATABASE_URL=postgresql://user:password@localhost:5432/trading_db

# OpenAI API
OPENAI_API_KEY=your_openai_api_key_here

# API Security
API_KEY=your_backend_api_key

# CORS
CORS_ORIGINS=["http://localhost:5173", "http://localhost:3000"]
```

### Step 3: PostgreSQL ì„¤ì •

```bash
# PostgreSQL ì„¤ì¹˜ (Windows)
# https://www.postgresql.org/download/windows/

# DB ìƒì„±
psql -U postgres
CREATE DATABASE trading_db;
\q
```

### Step 4: Python íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
cd BE
pip install -r requirements.txt
```

### Step 5: ë°±ì—”ë“œ ì‹¤í–‰

```bash
cd BE
python main.py
```

ë˜ëŠ”

```bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### Step 6: API í…ŒìŠ¤íŠ¸

```bash
# í—¬ìŠ¤ ì²´í¬
curl http://localhost:8000/health

# ëª¨ë¸ ìƒíƒœ í™•ì¸
curl http://localhost:8000/models/status

# ëª¨ë¸ ëª©ë¡ ì¡°íšŒ
curl http://localhost:8000/models/list
```

---

## ğŸ¯ API ì—”ë“œí¬ì¸íŠ¸ ì •ë¦¬

### ëª¨ë¸ ì˜ˆì¸¡ (3ê°œ ëª¨ë¸)

| ì—”ë“œí¬ì¸íŠ¸ | ëª¨ë¸ | ì„¤ëª… |
|-----------|------|------|
| `POST /predict/marl` | MARL 4-agent | 4ê°œ ì—ì´ì „íŠ¸ (ë‹¨ê¸°/ì¥ê¸°/ìœ„í—˜/ê°ì„±) |
| `POST /predict/model2` | MARL 3-agent | 3ê°œ ì—ì´ì „íŠ¸ (ê¸°ìˆ /ì‹œì¥/í€ë”ë©˜íƒˆ) |
| `POST /predict/model3` | A2C | A2C ì•Œê³ ë¦¬ì¦˜ (êµ¬í˜„ í•„ìš”) |

### ìš”ì²­ ì˜ˆì‹œ

```bash
curl -X POST "http://localhost:8000/predict/marl" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your_api_key" \
  -d '{
    "symbol": "005930",
    "features": {
      "SMA20": 70000,
      "MACD": 500,
      "RSI": 65,
      "Stoch_K": 70,
      "Bollinger_B": 0.8,
      "VIX": 15.5,
      "ROA": 0.08,
      "DebtRatio": 0.3,
      "AnalystRating": 4.2
    }
  }'
```

### ì‘ë‹µ ì˜ˆì‹œ

```json
{
  "model_type": "marl_4agent",
  "signal": "ë§¤ìˆ˜",
  "confidence_score": 0.85,
  "technical_indicators": {
    "SMA20": 70000,
    "MACD": 500,
    "RSI": 65,
    ...
  },
  "gpt_explanation": "í˜„ì¬ RSIê°€ 65ë¡œ ê³¼ë§¤ìˆ˜ êµ¬ê°„ì— ì§„ì…í•˜ì§€ ì•Šì•˜ìœ¼ë©°...",
  "xai_explanation": "ë‹¨ê¸° ì—ì´ì „íŠ¸: ë§¤ìˆ˜ (+1) | ì¥ê¸° ì—ì´ì „íŠ¸: ë§¤ìˆ˜ (+1) | ...",
  "xai_feature_importance": [
    {"feature": "RSI", "importance": 0.234, "agent": 0},
    {"feature": "MACD", "importance": 0.189, "agent": 0},
    ...
  ],
  "timestamp": "2025-11-29T12:34:56.789Z"
}
```

---

## ğŸ” ëª¨ë¸ë³„ íŠ¹ì§•

### Model 1: MARL 4-agent
- **ì—ì´ì „íŠ¸**: ë‹¨ê¸°, ì¥ê¸°, ìœ„í—˜ê´€ë¦¬, ê°ì„±ë¶„ì„
- **íŠ¹ì§•**: XAI ì„¤ëª… í¬í•¨, Feature importance ì œê³µ
- **ìƒíƒœ**: âœ… ì™„ì „ êµ¬í˜„

### Model 2: MARL 3-agent
- **ì—ì´ì „íŠ¸**: ê¸°ìˆ ì  ë¶„ì„, ì‹œì¥ ë¶„ì„, í€ë”ë©˜íƒˆ ë¶„ì„
- **íŠ¹ì§•**: 3ê°œ ì—ì´ì „íŠ¸ í˜‘ë ¥, QMIX ì•Œê³ ë¦¬ì¦˜
- **ìƒíƒœ**: âœ… ì—°ê²° ì™„ë£Œ (Scaler ìƒì„± í•„ìš”)

### Model 3: A2C
- **ì•Œê³ ë¦¬ì¦˜**: Advantage Actor-Critic
- **íŠ¹ì§•**: ë‹¨ì¼ ì—ì´ì „íŠ¸, ë¹ ë¥¸ ì¶”ë¡ 
- **ìƒíƒœ**: âš ï¸ êµ¬í˜„ í•„ìš”

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ëª¨ë¸ íŒŒì¼ ê²½ë¡œ
- MARL 4-agent: `AI/marl_4agent/qmix_model.pth`
- MARL 3-agent: `AI/marl_3agent/best_model.pth`
- A2C: `AI/a2c_file/model.pth` (ì—†ìŒ)

### 2. Scaler íŒŒì¼
- **ê° ëª¨ë¸ë§ˆë‹¤ ë³„ë„ì˜ `scaler.pkl` í•„ìš”** (ê³µìœ  ë¶ˆê°€)
- MARL 3-agentëŠ” `create_scaler.py` ì‹¤í–‰ í•„ìš”
- ì´ìœ : Feature ê°œìˆ˜ì™€ í†µê³„ ë¶„í¬ê°€ ë‹¤ë¦„

### 3. Feature ì¼ì¹˜
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë³´ë‚´ëŠ” featuresê°€ ëª¨ë¸ì´ ê¸°ëŒ€í•˜ëŠ” featuresì™€ ì¼ì¹˜í•´ì•¼ í•¨
- **MARL 4-agent**: 23ê°œ features (ê°ì„± ì§€í‘œ í¬í•¨)
  - ê¸°ë³¸: Close, High, Low, Volume, SMA20, MACD, RSI, etc.
  - ê°ì„±: Volume_Ratio, Price_Momentum_5/20, Price_Volatility, Market_Strength, VIX_Change, Price_Acceleration
- **MARL 3-agent**: 13ê°œ features (ê¸°ë³¸ ì§€í‘œë§Œ)
  - Close, High, Low, Volume, SMA20, MACD, MACD_Signal, RSI, Stoch_K, Stoch_D, ATR, Bollinger_B, VIX, ROA, DebtRatio, AnalystRating

### 4. GPU vs CPU
- GPU ì‚¬ìš© ê°€ëŠ¥ ì‹œ ìë™ìœ¼ë¡œ GPU ì‚¬ìš©
- CPUë§Œ ìˆì–´ë„ ì •ìƒ ë™ì‘ (ì†ë„ëŠ” ëŠë¦¼)

---

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ëª¨ë¸ ë¡œë“œ ì‹¤íŒ¨
```
MARL ëª¨ë¸ ë¡œë“œ ì‹¤íŒ¨: No such file or directory
```

**í•´ê²°**: ëª¨ë¸ íŒŒì¼ ê²½ë¡œ í™•ì¸
```bash
ls AI/marl_4agent/qmix_model.pth
ls AI/marl_3agent/best_model.pth
```

### ë¬¸ì œ 2: Scaler ì—†ìŒ
```
FileNotFoundError: scaler.pkl
```

**í•´ê²°**: Scaler ìƒì„±
```bash
cd AI/marl_3agent
python create_scaler.py
```

### ë¬¸ì œ 3: DB ì—°ê²° ì‹¤íŒ¨
```
sqlalchemy.exc.OperationalError: could not connect to server
```

**í•´ê²°**: PostgreSQL ì‹¤í–‰ í™•ì¸
```bash
# Windows
services.msc â†’ PostgreSQL ì„œë¹„ìŠ¤ ì‹œì‘
```

### ë¬¸ì œ 4: GPT API ì˜¤ë¥˜
```
GPT API í˜¸ì¶œ ì‹¤íŒ¨: Invalid API key
```

**í•´ê²°**: `.env` íŒŒì¼ì— ì˜¬ë°”ë¥¸ API í‚¤ ì„¤ì •
```bash
OPENAI_API_KEY=sk-...
```

---

## ğŸ“š ë‹¤ìŒ ë‹¨ê³„

1. âœ… MARL 3-agent Scaler ìƒì„±
2. âš ï¸ A2C ëª¨ë¸ êµ¬í˜„ ë˜ëŠ” ëŒ€ì²´
3. âœ… í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
4. âœ… ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”
5. âœ… ë°±ì—”ë“œ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸
6. ğŸ”„ í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™

---

## ğŸ“ ë¬¸ì˜

êµ¬í˜„ ì¤‘ ë¬¸ì œê°€ ë°œìƒí•˜ë©´:
1. `BE/README.md` ì°¸ê³ 
2. API ë¬¸ì„œ: `http://localhost:8000/docs` (Swagger UI)
3. ë¡œê·¸ í™•ì¸: ì½˜ì†” ì¶œë ¥ ë° ì—ëŸ¬ ë©”ì‹œì§€

---

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-29
